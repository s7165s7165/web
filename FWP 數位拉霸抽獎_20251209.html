<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FWP æ•¸ä½æ‹‰éœ¸æŠ½ç</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* --- åŸºç¤è¨­å®š --- */
        :root {
            --fw-blue-light: #1DADE5;
            --fw-blue-med: #007CC2;
            --fw-blue-dark: #004DA0;
            --fw-teal-light: #30B49F;
            --fw-teal-dark: #008487;
            --bg-gray: #f4f6f8;
            --text-color: #333;
            --header-height: 70px;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Helvetica Neue', Arial, 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-gray);
            margin: 0;
            display: flex;
            flex-direction: column;
            color: var(--text-color);
            /* æ‰‹æ©Ÿç‰ˆé è¨­è‡ªç„¶é«˜åº¦ï¼ŒPCç‰ˆå†é–å®š */
            min-height: 100vh;
            min-height: 100dvh; 
        }

        /* --- Header --- */
        header {
            background: linear-gradient(90deg, var(--bg-gray) 0%, var(--fw-teal-light) 40%, var(--fw-blue-light) 60%, var(--fw-blue-dark) 100%);
            color: white;
            height: var(--header-height);
            padding: 0 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 100;
            flex-shrink: 0;
        }

        /* --- ä¸»å®¹å™¨ (é è¨­ç‚ºæ‰‹æ©Ÿ/å¹³æ¿æµå‹•ä½ˆå±€) --- */
        .container {
            display: flex;
            flex-direction: column; /* é è¨­å‚ç›´æ’åˆ— */
            padding: 15px;
            gap: 20px;
            flex: 1;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* é€šç”¨é¢æ¿æ¨£å¼ */
        .panel {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        h2 {
            color: var(--fw-blue-dark);
            margin: 0 0 15px 0;
            font-size: 1.1rem;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            font-weight: 600;
        }

        /* --- å·¦å´ï¼šè¨­å®šå€ --- */
        .left-panel { order: 2; } /* æ‰‹æ©Ÿç‰ˆæ”¾åœ¨æ‹‰éœ¸æ©Ÿä¸‹é¢ */
        
        textarea {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            resize: none;
            font-size: 14px;
            margin-bottom: 15px;
            outline: none;
            min-height: 150px; /* æ‰‹æ©Ÿç‰ˆæœ€å°é«˜åº¦ */
            width: 100%;
        }
        textarea:focus { border-color: var(--fw-blue-med); box-shadow: 0 0 0 2px rgba(29, 173, 229, 0.2); }

        button {
            padding: 12px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.2s;
            touch-action: manipulation; /* å„ªåŒ–è§¸æ§ */
        }
        .btn-import { background-color: var(--fw-teal-light); color: white; width: 100%; }
        .btn-import:hover { background-color: var(--fw-teal-dark); }
        .btn-import:active { transform: scale(0.98); }

        /* --- ä¸­é–“ï¼šæ‹‰éœ¸æ©Ÿ --- */
        .center-panel {
            order: 1; /* æ‰‹æ©Ÿç‰ˆæœ€å„ªå…ˆé¡¯ç¤º */
            border-top: 5px solid var(--fw-teal-light);
            align-items: center;
            justify-content: center;
            padding: 30px 20px;
        }

        .slot-machine-frame {
            background: linear-gradient(135deg, var(--fw-blue-dark), var(--fw-blue-med));
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2), inset 0 0 20px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 600px;
            text-align: center;
            margin-bottom: 30px;
            border: 4px solid #fff;
        }

        .slot-window {
            background: #fff;
            height: 140px; /* ç¨å¾®åŠ å¤§é«˜åº¦ */
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #ccc;
        }

        .slot-text {
            /* éŸ¿æ‡‰å¼å­—é«”ï¼šæœ€å°24pxï¼Œæœ€å¤§56pxï¼Œä¾è¦–çª—å¯¬åº¦èª¿æ•´ */
            font-size: clamp(24px, 6vw, 56px);
            font-weight: 700;
            color: var(--text-color);
            white-space: nowrap;
            padding: 0 10px;
        }
        
        .slot-window::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 40%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.5), rgba(255,255,255,0));
            pointer-events: none;
        }

        .btn-spin {
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
            color: white;
            font-size: 22px;
            padding: 15px 0;
            width: 80%; /* æ‰‹æ©Ÿç‰ˆå¯¬åº¦ */
            max-width: 250px;
            border-radius: 50px;
            box-shadow: 0 6px 0 #962d22, 0 10px 15px rgba(0,0,0,0.2);
            position: relative;
            top: 0;
        }
        .btn-spin:active { top: 6px; box-shadow: 0 0 0 #962d22, 0 0 0 rgba(0,0,0,0.2); }
        .btn-spin:disabled { background: #95a5a6; box-shadow: none; top: 6px; cursor: not-allowed; }

        /* --- å³å´ï¼šä¸­çåå–® --- */
        .right-panel {
            order: 3;
            border-top: 5px solid var(--fw-blue-dark);
            max-height: 500px; /* æ‰‹æ©Ÿç‰ˆé™åˆ¶é«˜åº¦ï¼Œå…§éƒ¨æ»¾å‹• */
        }
        .winner-list-container { flex: 1; overflow-y: auto; min-height: 150px; }
        .winner-list { list-style: none; padding: 0; margin: 0; }
        .winner-list li {
            background: #f8f9fa;
            border-left: 4px solid var(--fw-teal-light);
            margin-bottom: 8px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
            font-size: 15px;
        }
        .winner-list li span.rank {
            background: var(--fw-blue-dark);
            color: white;
            width: 24px; height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px; font-size: 12px;
            flex-shrink: 0;
            margin-right: 10px;
        }

        /* --- å½ˆçª— Modal --- */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 77, 160, 0.8);
            backdrop-filter: blur(5px);
            justify-content: center; align-items: center; z-index: 2000;
            padding: 20px;
        }
        .modal-content {
            background: white; padding: 40px 30px; border-radius: 16px; text-align: center;
            box-shadow: 0 25px 50px rgba(0,0,0,0.4); 
            width: 100%; max-width: 400px;
            border-top: 8px solid var(--fw-blue-med);
            animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes modalPop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal h2 { color: var(--fw-teal-light); font-size: 1.8rem; border: none; margin-bottom: 10px; }
        .modal p { 
            font-size: clamp(2rem, 8vw, 2.5rem); 
            font-weight: bold; color: var(--fw-blue-dark); margin: 20px 0 40px 0; word-break: break-all; 
        }
        .modal button { background-color: var(--fw-blue-med); color: white; width: 100%; padding: 15px; font-size: 18px; border-radius: 8px;}

        /* --- PC (Desktop) å°ˆç”¨æ¨£å¼ --- */
        @media (min-width: 1024px) {
            body {
                height: 100vh; /* PC é–å®šé«˜åº¦ */
                overflow: hidden;
            }
            .container {
                flex-direction: row; /* æ°´å¹³æ’åˆ— */
                height: calc(100vh - var(--header-height));
                overflow: hidden;
            }
            
            .panel { height: 100%; border-top: 5px solid var(--fw-blue-med); }
            .center-panel { border-top: 5px solid var(--fw-teal-light); }
            .right-panel { border-top: 5px solid var(--fw-blue-dark); max-height: none; }
            
            .left-panel { width: 25%; min-width: 280px; order: 1; }
            .center-panel { flex: 1; order: 2; }
            .right-panel { width: 25%; min-width: 280px; order: 3; }
            
            textarea { margin-bottom: 20px; }
        }

        /* --- å¹³æ¿ (Tablet) èª¿æ•´ --- */
        @media (min-width: 600px) and (max-width: 1023px) {
            .container {
                display: grid;
                grid-template-columns: 1fr 1fr;
                grid-template-rows: auto auto;
                gap: 20px;
            }
            .center-panel { grid-column: 1 / -1; order: 1; } /* æ‹‰éœ¸æ©Ÿä½”æ»¿ä¸Šæ–¹ */
            .left-panel { order: 2; height: 500px; }
            .right-panel { order: 3; height: 500px; max-height: 500px; }
        }
    </style>
</head>
<body>

<header>
    <div style="display: flex; align-items: center; gap: 15px;">
        <img src="https://www.fwp.com.tw/_next/image?url=%2Fimages%2Flogo2.png&w=384&q=75" alt="FWP Logo" style="height: 35px; width: auto;">
    </div>
    <span style="font-size: 16px; opacity: 0.9; font-weight: 300; display: none; margin-left: auto; @media(min-width:768px){display:inline;}">Empowering a Greener Future</span>
</header>

<div class="container">
    <div class="panel left-panel">
        <h2>äººå“¡åå–®è¨­ç½®</h2>
        <textarea id="participants" placeholder="è«‹åœ¨æ­¤è¼¸å…¥åå–®...&#10;ç‹å°æ˜&#10;Alice&#10;Bob&#10;é™³å¤§æ–‡"></textarea>
        <button class="btn-import" onclick="importNames()">åŒ¯å…¥åå–®ä¸¦é‡ç½®</button>
        <div style="margin-top: 15px; text-align: right; color: #666; font-size: 14px; display: flex; justify-content: space-between;">
            <span>ç‹€æ…‹</span>
            <span>å¾…æŠ½äººæ•¸: <span id="count" style="color: var(--fw-blue-med); font-weight: bold; font-size: 1.2em;">0</span></span>
        </div>
    </div>

    <div class="panel center-panel">
        <div class="slot-machine-frame">
            <div class="slot-window">
                <div id="slotText" class="slot-text">æº–å‚™æŠ½ç</div>
            </div>
        </div>
        <button id="spinBtn" class="btn-spin" onclick="startSpin()" disabled>é–‹å§‹æŠ½ç</button>
        <p style="margin-top:20px; color:#888; font-size:14px;">é»æ“ŠæŒ‰éˆ•éš¨æ©ŸæŠ½å‡ºä¸€ä½å¹¸é‹å…’</p>
    </div>

    <div class="panel right-panel">
        <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; margin-bottom: 10px;">
            <h2 style="border:none; margin:0; padding:0;">ä¸­çåå–®</h2>
            <button onclick="clearWinners()" style="background:transparent; border: 1px solid #ccc; color:#666; padding: 5px 10px; font-size:12px; border-radius: 4px;">æ¸…ç©º</button>
        </div>
        <div class="winner-list-container">
            <ul id="winnerList" class="winner-list"></ul>
        </div>
    </div>
</div>

<div id="congratsModal" class="modal">
    <div class="modal-content">
        <h2>ğŸŠ æ­å–œç²ç ğŸŠ</h2>
        <p id="winnerName">---</p>
        <button onclick="closeModal()">ç¢ºèª</button>
    </div>
</div>

<audio id="winAudio" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" preload="auto"></audio>

<script>
    let names = [];
    let isSpinning = false;
    let audioCtx = null;
    let currentWinnerIndex = -1;

    // é è¨­è³‡æ–™
    const defaultData = "FP8888 éƒ­å®ˆå¯Œ\nSF0016 éƒééµ¬\nSF0149 æ¥Šå…ä»\nSF0170 æ—æ†¶æ±\nSF0176 æ›¾å½¥éœ–\nSF0190 æ¥Šä½³ç¸‰\nSF0194 è—ç…’æ™º\nFP0001 å‘‚å®—é§¿\nFP0002 è¨±å† è¯\nFP0004 å³å½¥è¼\nFP0005 æ—æŒ¯èŠ³\nFP0006 ç‹æ…§æ•\nFP0007 é™³èªæŸ”\nFP0008 è”¡é‡‘ç«¥\nFP0009 æ¥Šæ®¿é©Š\nFP0011 åŠ‰å®¶å¯§\nFP0012 æ½˜æ›‰æ°\nFP0013 å³æ³°æ¾„\nFP0014 æ—é€¸æ¾\nFP0015 æä½³è“\nFP0016 é„­è¶…å…ƒ\nFP0018 æ—ä½‘åº­\nFP0020 é™³æ›¸æ¯“\nFP0022 æŸ¯æ¹˜çª\nFP0024 é™³å† å©·\nFP0026 å‘‚æ˜Œéš†\nFP0028 é»ƒå®å’Œ\nFP0031 æˆ´å±•ç¥º\nFP0032 å³å¿µå€«\nFP0033 é»ƒæ–‡é’\nFP0034 é™³æ˜ å½¤\nFP0035 è‘‰å®¶å­œ\nFP0036 è–›é–”è²\nFP0037 å‘¨æ˜±è¾°\nFP0038 æ—å®è‡»\nFP0040 å³ç•¥æº±\nFP0041 æ—å¦‚å³°\nFP0042 å»–å°¹ç‘„\nFP0043 é„­å·å»·\nFP0044 ä½•ç‰ç\nFP0045 æ—æ›¸ç·¯\nFP0046 ææ”¿æ†²\nFP0047 é»ƒæ˜­å„’\nFP0048 æ±ŸéŠ˜å‡±\nFP0049 é„­å®‰é©›\nFP0050 æ¥Šå®œèŠ¬\nFP0051 é™³æŸå®‰\nFP0052 è¬æ”¿é‘‘\nFP0054 æ²ˆæ˜¶ä½‘\nFP0055 å¤è© ç‘­\nFP0058 å€ªå­æ¶µ\nFP0059 æ¸¸è‚²æ˜Œ\nFP0060 å³ä½³èŠ¸\nFP0061 é»ƒç…’ç¿”\nFP0062 é«˜åœ‹å‰\nFP0063 é™³é´»å„€\nFW0005 æ´ªç¹¼é–‹\nFP0064 é™³è¡æš¢\nFP0065 ç‹ä¸€å¸†\nFP0066 ç‹è€€å¾·\nFP0067 æå¥æ–°\nFP0068 é™³é¦™è±\nFP0071 è©¹æ™ºéˆ\nFP0073 æä¿¡å‡\nFP0074 é™³æ¶µèŠ¸\nFP0075 åš´éœ†\nFP0076 èŠå¿ƒç‘œ\nFP0077 é¥’é‹ç¥¥\nFP0079 å³è‹¥æ¶µ\nFP0080 é­æ„ç’‡\nFP0081 æ±Ÿé’é¾";

    window.onload = function() {
        document.getElementById("participants").value = defaultData;
        importNames();
    };

    // è§£æ±º iOS Safari éŸ³æ•ˆéœ€è¦åœ¨ä½¿ç”¨è€…äº’å‹•å¾Œæ‰èƒ½æ’­æ”¾çš„å•é¡Œ
    function initAudio() {
        if (!audioCtx) {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();
        }
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    function playTickSound(frequency = 600) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.setValueAtTime(frequency, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime); // é™ä½ä¸€é»éŸ³é‡
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.05);
    }

    function playWinSound() {
        const audio = document.getElementById("winAudio");
        audio.currentTime = 0;
        audio.play().catch(e => console.log("Auto-play blocked", e));
    }

    function importNames() {
        if (isSpinning) return;
        const text = document.getElementById("participants").value;
        names = text.split('\n').filter(name => name.trim() !== "");
        document.getElementById("count").innerText = names.length;
        document.getElementById("slotText").innerText = "æº–å‚™æŠ½ç";
        document.getElementById("slotText").style.color = "var(--text-color)";
        document.getElementById("spinBtn").disabled = names.length === 0;
    }

    function startSpin() {
        if (isSpinning || names.length === 0) return;
        initAudio(); // ç¢ºä¿éŸ³æ•ˆç’°å¢ƒå•Ÿå‹•
        isSpinning = true;
        document.getElementById("spinBtn").disabled = true;
        document.getElementById("spinBtn").innerText = "æŠ½çä¸­...";
        
        const slotText = document.getElementById("slotText");
        currentWinnerIndex = Math.floor(Math.random() * names.length);
        const winner = names[currentWinnerIndex];

        let duration = 3000; 
        let startTime = null;
        let lastFrameTime = 0;
        let speed = 50;

        slotText.style.filter = "blur(2px)"; // æ‰‹æ©Ÿä¸Š blur å¤ªé‡æœƒå¡ï¼Œæ”¹å°ä¸€é»
        slotText.style.color = "var(--fw-blue-med)";

        function step(timestamp) {
            if (!startTime) startTime = timestamp;
            const progress = timestamp - startTime;

            if (timestamp - lastFrameTime > speed) {
                const randomName = names[Math.floor(Math.random() * names.length)];
                slotText.innerText = randomName;
                playTickSound(400 + Math.random() * 200); 
                lastFrameTime = timestamp;

                if (progress > duration * 0.7) {
                    speed += 10;
                }
            }

            if (progress < duration) {
                requestAnimationFrame(step);
            } else {
                finishSpin(winner);
            }
        }

        requestAnimationFrame(step);
    }

    function finishSpin(winnerName) {
        const slotText = document.getElementById("slotText");
        slotText.innerText = winnerName;
        slotText.style.filter = "blur(0)";
        slotText.style.color = "#e74c3c";
        slotText.style.transform = "scale(1.1)";
        
        setTimeout(() => {
             slotText.style.transform = "scale(1)";
             showWinnerModal(winnerName);
        }, 300);
        
        isSpinning = false;
    }

    function showWinnerModal(name) {
        document.getElementById("winnerName").innerText = name;
        const modal = document.getElementById("congratsModal");
        modal.style.display = "flex";
        playWinSound();
        fireConfetti();
    }

    function fireConfetti() {
        var end = Date.now() + 3000;
        (function frame() {
            confetti({
                particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, zIndex: 2001,
                colors: ['#007CC2', '#30B49F', '#1DADE5'],
                disableForReducedMotion: true // å°Šé‡ä½¿ç”¨è€…è¨­å®š
            });
            confetti({
                particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, zIndex: 2001,
                colors: ['#007CC2', '#30B49F', '#1DADE5'],
                disableForReducedMotion: true
            });
            if (Date.now() < end) requestAnimationFrame(frame);
        }());
    }

    function closeModal() {
        const modal = document.getElementById("congratsModal");
        modal.style.display = "none";
        
        addWinnerToList(names[currentWinnerIndex]);
        names.splice(currentWinnerIndex, 1);
        document.getElementById("count").innerText = names.length;
        document.getElementById("slotText").style.color = "var(--text-color)";
        
        const audio = document.getElementById("winAudio");
        audio.pause();
        audio.currentTime = 0;

        if (names.length > 0) {
            document.getElementById("spinBtn").disabled = false;
            document.getElementById("spinBtn").innerText = "é–‹å§‹æŠ½ç";
            document.getElementById("slotText").innerText = "ä¸‹ä¸€ä½...";
        } else {
            document.getElementById("spinBtn").innerText = "å·²çµæŸ";
            document.getElementById("slotText").innerText = "åå–®å·²ç©º";
            alert("åå–®å·²å…¨æ•¸æŠ½å‡ºï¼");
        }
    }

    function addWinnerToList(name) {
        const list = document.getElementById("winnerList");
        const li = document.createElement("li");
        const count = list.children.length + 1;
        li.innerHTML = `<span class="rank">${count}</span> <span>${name}</span>`;
        list.appendChild(li);
        
        // è‡ªå‹•æ²å‹•åˆ°æœ€æ–°ä¸­çè€…
        const container = document.querySelector('.winner-list-container');
        container.scrollTop = container.scrollHeight;
    }

    function clearWinners() {
        if(confirm("ç¢ºå®šæ¸…ç©ºä¸­çç´€éŒ„ï¼Ÿ")) document.getElementById("winnerList").innerHTML = "";
    }
</script>

</body>
</html>
