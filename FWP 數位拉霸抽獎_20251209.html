<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FWP æ•¸ä½æ‹‰éœ¸æŠ½ç</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        /* FWP å“ç‰Œè‰²ç³» */
        :root {
            --fw-blue-light: #1DADE5;
            --fw-blue-med: #007CC2;
            --fw-blue-dark: #004DA0;
            --fw-teal-light: #30B49F;
            --fw-teal-dark: #008487;
            --bg-gray: #f4f6f8;
            --text-color: #333;
        }

        body {
            font-family: 'Helvetica Neue', Arial, 'Microsoft JhengHei', sans-serif;
            background-color: var(--bg-gray);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: var(--text-color);
            overflow: hidden;
        }

        /* é ‚éƒ¨ Header */
        header {
            background: linear-gradient(90deg, var(--bg-gray) 20%, var(--fw-teal-light) 50%, var(--fw-blue-light) 67%, var(--fw-blue-med) 83%, var(--fw-blue-dark) 100%);
            color: white;
            padding: 15px 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 10;
        }
        header h1 { margin: 0; font-size: 24px; font-weight: 500; letter-spacing: 1px; }

        /* ä¸»ä½ˆå±€ */
        .container {
            display: flex;
            flex: 1;
            padding: 20px;
            gap: 20px;
            overflow: hidden;
            position: relative;
        }

        .panel {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            padding: 20px;
            display: flex;
            flex-direction: column;
            border-top: 5px solid var(--fw-blue-med);
        }

        h2 {
            color: var(--fw-blue-dark);
            margin: 0 0 15px 0;
            font-size: 18px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        /* å·¦å´ï¼šè¨­å®šå€ */
        .left-panel { width: 25%; min-width: 250px; z-index: 20; }
        textarea {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: none;
            font-size: 14px;
            margin-bottom: 15px;
            outline: none;
        }
        textarea:focus { border-color: var(--fw-blue-med); }
        
        button {
            padding: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            transition: all 0.2s;
        }
        .btn-import { background-color: var(--fw-teal-light); color: white; }
        .btn-import:hover { background-color: var(--fw-teal-dark); }

        /* ä¸­é–“ï¼šæ‹‰éœ¸æ©Ÿ */
        .center-panel {
            flex: 1;
            align-items: center;
            justify-content: center;
            background: #fff;
            border-top: 5px solid var(--fw-teal-light);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        /* æ‹‰éœ¸æ©Ÿå¤–æ®¼ */
        .slot-machine-frame {
            background: linear-gradient(135deg, var(--fw-blue-dark), var(--fw-blue-med));
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2), inset 0 0 10px rgba(0,0,0,0.3);
            width: 100%;
            max-width: 500px;
            text-align: center;
            margin-bottom: 30px;
            border: 4px solid #fff;
        }

        /* é¡¯ç¤ºåå­—çš„çª—å£ */
        .slot-window {
            background: #fff;
            height: 120px;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #ccc;
        }

        /* æ»¾å‹•çš„åå­—æ–‡å­— */
        .slot-text {
            font-size: 48px;
            font-weight: bold;
            color: var(--text-color);
            white-space: nowrap;
            /* è®“æ–‡å­—æœ‰é»æ¨¡ç³Šæ•ˆæœï¼Œæ¨¡æ“¬å¿«é€Ÿè½‰å‹• */
            filter: blur(0px); 
            transition: transform 0.1s, filter 0.1s;
        }
        
        /* è£é£¾ç·šï¼šæ¨¡æ“¬è¢å¹•åå…‰ */
        .slot-window::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; height: 50%;
            background: linear-gradient(to bottom, rgba(255,255,255,0.4), rgba(255,255,255,0));
            pointer-events: none;
        }

        .btn-spin {
            background: linear-gradient(to bottom, #e74c3c, #c0392b);
            color: white;
            font-size: 24px;
            padding: 15px 80px;
            border-radius: 50px;
            box-shadow: 0 6px 0 #962d22, 0 10px 10px rgba(0,0,0,0.3);
            border: none;
            letter-spacing: 2px;
            position: relative;
            top: 0;
            transition: all 0.1s;
        }
        .btn-spin:active {
            top: 6px;
            box-shadow: 0 0 0 #962d22, 0 0 0 rgba(0,0,0,0.3);
        }
        .btn-spin:disabled {
            background: #95a5a6;
            box-shadow: none;
            cursor: not-allowed;
            top: 6px;
        }

        /* å³å´ï¼šä¸­çåå–® */
        .right-panel { width: 25%; min-width: 250px; border-top: 5px solid var(--fw-blue-dark); overflow: hidden; }
        .winner-list-container { flex: 1; overflow-y: auto; }
        .winner-list { list-style: none; padding: 0; margin: 0; }
        .winner-list li {
            background: #f8f9fa;
            border-left: 4px solid var(--fw-teal-light);
            margin-bottom: 8px;
            padding: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }
        .winner-list li span.rank {
            background: var(--fw-blue-dark);
            color: white;
            width: 24px; height: 24px;
            border-radius: 50%;
            text-align: center;
            line-height: 24px; font-size: 12px;
        }

        /* å½ˆçª— */
        .modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 77, 160, 0.7);
            backdrop-filter: blur(4px);
            justify-content: center; align-items: center; z-index: 2000;
        }
        .modal-content {
            background: white; padding: 50px; border-radius: 12px; text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); max-width: 450px; width: 90%;
            border-top: 8px solid var(--fw-blue-med);
            animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes modalPop { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal h2 { color: var(--fw-teal-light); font-size: 28px; border: none; margin-bottom: 10px; }
        .modal p { font-size: 42px; font-weight: bold; color: var(--fw-blue-dark); margin: 20px 0 40px 0; }
        .modal button { background-color: var(--fw-blue-med); color: white; width: 100%; padding: 15px; font-size: 18px; border:none; border-radius:4px; cursor:pointer;}

        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 900px) {
            .container { flex-direction: column; height: auto; overflow-y: auto; }
            .left-panel, .center-panel, .right-panel { width: 100%; height: auto; min-height: 300px;}
        }
    </style>
</head>
<body>

<header>
    <img src="https://www.fwp.com.tw/_next/image?url=%2Fimages%2Flogo2.png&w=384&q=75" alt="FWP Logo" style="height: 40px;">
    <span style="font-size: 24px; opacity: 0.8;">Empowering a Greener Future</span>
</header>

<div class="container">
    <div class="panel left-panel">
        <h2>äººå“¡åå–®è¨­ç½®</h2>
        <textarea id="participants" placeholder="è«‹åœ¨æ­¤è¼¸å…¥åå–®...&#10;ç‹å°æ˜&#10;Alice&#10;Bob&#10;é™³å¤§æ–‡"></textarea>
        <button class="btn-import" onclick="importNames()">åŒ¯å…¥åå–®ä¸¦é‡ç½®</button>
        <div style="margin-top: 10px; text-align: right; color: #888; font-size: 13px;">
            å¾…æŠ½äººæ•¸: <span id="count" style="color: var(--fw-blue-med); font-weight: bold;">0</span>
        </div>
    </div>

    <div class="panel center-panel">
        <div class="slot-machine-frame">
            <div class="slot-window">
                <div id="slotText" class="slot-text">æº–å‚™æŠ½ç</div>
            </div>
        </div>
        <button id="spinBtn" class="btn-spin" onclick="startSpin()" disabled>é–‹å§‹</button>
        <p style="margin-top:10px; color:#888; font-size:14px;">é»æ“ŠæŒ‰éˆ•éš¨æ©ŸæŠ½å‡ºä¸€ä½å¹¸é‹å…’</p>
    </div>

    <div class="panel right-panel">
        <h2>ä¸­çåå–®</h2>
        <div class="winner-list-container">
            <ul id="winnerList" class="winner-list"></ul>
        </div>
        <button onclick="clearWinners()" style="background:#fff; border: 1px solid #ccc; color:#666; margin-top:15px; font-size:13px;">æ¸…ç©ºç´€éŒ„</button>
    </div>
</div>

<div id="congratsModal" class="modal">
    <div class="modal-content">
        <h2>ğŸŠ æ­å–œç²ç ğŸŠ</h2>
        <p id="winnerName">---</p>
        <button onclick="closeModal()">ç¢ºèª</button>
    </div>
</div>

<audio id="winAudio" src="https://assets.mixkit.co/sfx/preview/mixkit-winning-chimes-2015.mp3" preload="auto"></audio>

<script>
    let names = [];
    let isSpinning = false;
    let audioCtx = null;
    let timer = null;
    let currentWinnerIndex = -1;

    // åˆå§‹åŒ–
    window.onload = function() {
        document.getElementById("participants").value = "FP8888 éƒ­å®ˆå¯Œ\nSF0016 éƒééµ¬\nSF0149 æ¥Šå…ä»\nSF0170 æ—æ†¶æ±\nSF0176 æ›¾å½¥éœ–\nSF0190 æ¥Šä½³ç¸‰\nSF0194 è—ç…’æ™º\nFP0001 å‘‚å®—é§¿\nFP0002 è¨±å† è¯\nFP0004 å³å½¥è¼\nFP0005 æ—æŒ¯èŠ³\nFP0006 ç‹æ…§æ•\nFP0007 é™³èªæŸ”\nFP0008 è”¡é‡‘ç«¥\nFP0009 æ¥Šæ®¿é©Š\nFP0011 åŠ‰å®¶å¯§\nFP0012 æ½˜æ›‰æ°\nFP0013 å³æ³°æ¾„\nFP0014 æ—é€¸æ¾\nFP0015 æä½³è“\nFP0016 é„­è¶…å…ƒ\nFP0018 æ—ä½‘åº­\nFP0020 é™³æ›¸æ¯“\nFP0022 æŸ¯æ¹˜çª\nFP0024 é™³å† å©·\nFP0026 å‘‚æ˜Œéš†\nFP0028 é»ƒå®å’Œ\nFP0031 æˆ´å±•ç¥º\nFP0032 å³å¿µå€«\nFP0033 é»ƒæ–‡é’\nFP0034 é™³æ˜ å½¤\nFP0035 è‘‰å®¶å­œ\nFP0036 è–›é–”è²\nFP0037 å‘¨æ˜±è¾°\nFP0038 æ—å®è‡»\nFP0040 å³ç•¥æº±\nFP0041 æ—å¦‚å³°\nFP0042 å»–å°¹ç‘„\nFP0043 é„­å·å»·\nFP0044 ä½•ç‰ç\nFP0045 æ—æ›¸ç·¯\nFP0046 ææ”¿æ†²\nFP0047 é»ƒæ˜­å„’\nFP0048 æ±ŸéŠ˜å‡±\nFP0049 é„­å®‰é©›\nFP0050 æ¥Šå®œèŠ¬\nFP0051 é™³æŸå®‰\nFP0052 è¬æ”¿é‘‘\nFP0054 æ²ˆæ˜¶ä½‘\nFP0055 å¤è© ç‘­\nFP0058 å€ªå­æ¶µ\nFP0059 æ¸¸è‚²æ˜Œ\nFP0060 å³ä½³èŠ¸\nFP0061 é»ƒç…’ç¿”\nFP0062 é«˜åœ‹å‰\nFP0063 é™³é´»å„€\nFW0005 æ´ªç¹¼é–‹\nFP0064 é™³è¡æš¢\nFP0065 ç‹ä¸€å¸†\nFP0066 ç‹è€€å¾·\nFP0067 æå¥æ–°\nFP0068 é™³é¦™è±\nFP0071 è©¹æ™ºéˆ\nFP0073 æä¿¡å‡\nFP0074 é™³æ¶µèŠ¸\nFP0075 åš´éœ†\nFP0076 èŠå¿ƒç‘œ\nFP0077 é¥’é‹ç¥¥\nFP0079 å³è‹¥æ¶µ\nFP0080 é­æ„ç’‡\nFP0081 æ±Ÿé’é¾";
        importNames();
    };

    function initAudio() {
        if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === 'suspended') audioCtx.resume();
    }

    // æ¨¡æ“¬æ©Ÿæ¢°æ»¾å‹•çš„çŸ­ä¿ƒéŸ³æ•ˆ
    function playTickSound(frequency = 600) {
        if (!audioCtx) return;
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine'; // Sine æ³¢æ¯”è¼ƒåœ“æ½¤å¯æ„›
        osc.frequency.setValueAtTime(frequency, audioCtx.currentTime);
        gain.gain.setValueAtTime(10.0, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.05);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.05);
    }

    function playWinSound() {
        const audio = document.getElementById("winAudio");
        audio.currentTime = 0;
        audio.play().catch(e => console.log("éŸ³æ•ˆè¢«é˜»æ“‹", e));
    }

    function importNames() {
        if (isSpinning) return;
        const text = document.getElementById("participants").value;
        names = text.split('\n').filter(name => name.trim() !== "");
        document.getElementById("count").innerText = names.length;
        document.getElementById("slotText").innerText = "æº–å‚™æŠ½ç";
        document.getElementById("slotText").style.color = "var(--text-color)";
        
        document.getElementById("spinBtn").disabled = names.length === 0;
    }

    function startSpin() {
        if (isSpinning || names.length === 0) return;
        initAudio();
        isSpinning = true;
        document.getElementById("spinBtn").disabled = true;
        document.getElementById("spinBtn").innerText = "æŠ½çä¸­...";
        
        const slotText = document.getElementById("slotText");
        
        // é å…ˆæ±ºå®šä¸­çè€…
        currentWinnerIndex = Math.floor(Math.random() * names.length);
        const winner = names[currentWinnerIndex];

        // å‹•ç•«æ§åˆ¶åƒæ•¸
        let duration = 3000; // ç¸½æ™‚é•· 3ç§’
        let startTime = null;
        let lastFrameTime = 0;
        let speed = 50; // åˆå§‹é€Ÿåº¦ (ms/frame)

        // è¦–è¦ºæ¨¡ç³Šæ•ˆæœ
        slotText.style.filter = "blur(1px)";
        slotText.style.color = "var(--fw-blue-med)";

        function step(timestamp) {
            if (!startTime) startTime = timestamp;
            const progress = timestamp - startTime;

            // æ¯éš” speed æ¯«ç§’æ›´æ–°ä¸€æ¬¡ç•«é¢
            if (timestamp - lastFrameTime > speed) {
                // éš¨æ©Ÿé¡¯ç¤ºä¸€å€‹åå­—
                const randomName = names[Math.floor(Math.random() * names.length)];
                slotText.innerText = randomName;
                
                // æ’­æ”¾æ»¾å‹•éŸ³æ•ˆ
                playTickSound(400 + Math.random() * 200); 

                lastFrameTime = timestamp;

                // æ¸›é€Ÿé‚è¼¯ï¼šæ™‚é–“éåŠå¾Œï¼Œé€Ÿåº¦è®Šæ…¢
                if (progress > duration * 0.7) {
                    speed += 10; // è¶Šä¾†è¶Šæ…¢
                }
            }

            if (progress < duration) {
                requestAnimationFrame(step);
            } else {
                // åœæ­¢ï¼Œé¡¯ç¤ºæœ€çµ‚å¾—ä¸»
                finishSpin(winner);
            }
        }

        requestAnimationFrame(step);
    }

    function finishSpin(winnerName) {
        const slotText = document.getElementById("slotText");
        slotText.innerText = winnerName;
        slotText.style.filter = "blur(0)"; // æ¸…é™¤æ¨¡ç³Š
        slotText.style.color = "#e74c3c"; // å¼·èª¿è‰²
        slotText.style.transform = "scale(1.2)"; // æ”¾å¤§æ•ˆæœ
        
        setTimeout(() => {
             slotText.style.transform = "scale(1)";
             showWinnerModal(winnerName);
        }, 300);
        
        isSpinning = false;
    }

    function showWinnerModal(name) {
        document.getElementById("winnerName").innerText = name;
        document.getElementById("congratsModal").style.display = "flex";
        playWinSound();
        fireConfetti();
    }

    function fireConfetti() {
        var end = Date.now() + 3000;
        (function frame() {
            confetti({
                particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, zIndex: 2001,
                colors: ['#007CC2', '#30B49F', '#1DADE5'] // FWP colors
            });
            confetti({
                particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, zIndex: 2001,
                colors: ['#007CC2', '#30B49F', '#1DADE5']
            });
            if (Date.now() < end) requestAnimationFrame(frame);
        }());
    }

    function closeModal() {
        const modal = document.getElementById("congratsModal");
        modal.style.display = "none";
        
        // åŠ å…¥åå–®ä¸¦ç§»é™¤
        addWinnerToList(names[currentWinnerIndex]);
        names.splice(currentWinnerIndex, 1);
        document.getElementById("count").innerText = names.length;
        document.getElementById("slotText").style.color = "var(--text-color)";
        
        // åœæ­¢éŸ³æ¨‚
        const audio = document.getElementById("winAudio");
        audio.pause();
        audio.currentTime = 0;

        if (names.length > 0) {
            document.getElementById("spinBtn").disabled = false;
            document.getElementById("spinBtn").innerText = "é–‹å§‹";
            document.getElementById("slotText").innerText = "ä¸‹ä¸€ä½...";
        } else {
            document.getElementById("spinBtn").innerText = "å·²çµæŸ";
            document.getElementById("slotText").innerText = "åå–®å·²ç©º";
            alert("åå–®å·²å…¨æ•¸æŠ½å‡ºï¼");
        }
    }

    function addWinnerToList(name) {
        const list = document.getElementById("winnerList");
        const li = document.createElement("li");
        const count = list.children.length + 1;
        li.innerHTML = `<span class="rank">${count}</span> <span>${name}</span>`;
        list.appendChild(li);
        const container = document.querySelector('.winner-list-container');
        container.scrollTop = container.scrollHeight;
    }

    function clearWinners() {
        if(confirm("ç¢ºå®šæ¸…ç©ºï¼Ÿ")) document.getElementById("winnerList").innerHTML = "";
    }
</script>

</body>
</html>
